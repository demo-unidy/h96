---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Meine Tickets - Hannover 96" activePage="tickets" pageStyles={['tickets']}>
    <main class="main-content tickets-main">
        <div class="container">
            <!-- Page Header -->
            <div class="tickets-header">
                <h1 class="tickets-header__title">Meine Tickets</h1>
                <p class="tickets-header__subtitle">Verwalte hier deine Eintrittskarten für die HDI-Arena</p>
            </div>

            <!-- Not Logged In State -->
            <u-signed-in not>
                <div class="tickets-not-logged-in">
                    <div class="tickets-not-logged-in__icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M2 9a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3"/>
                            <path d="M2 9v9a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V9"/>
                            <path d="M2 9l3.5 3.5L9 9"/>
                            <path d="M22 9l-3.5 3.5L15 9"/>
                            <line x1="12" y1="13" x2="12" y2="17"/>
                            <line x1="10" y1="15" x2="14" y2="15"/>
                        </svg>
                    </div>
                    <h2 class="tickets-not-logged-in__title">Bitte melde dich an</h2>
                    <p class="tickets-not-logged-in__text">
                        Melde dich an, um deine Tickets, Mitgliedschaften und Spielregistrierungen zu sehen.
                    </p>
                    <button type="button" class="btn btn-primary" onclick="openLoginModal()">Zur Anmeldung</button>
                </div>
            </u-signed-in>

            <!-- Logged In Content -->
            <u-signed-in>
                <div class="tickets-content">

                    <!-- Upcoming Matches / Active Tickets -->
                    <section class="tickets-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                </svg>
                                Kommende Spiele
                            </h2>
                        </div>

                        <u-ticketable-list ticketable-type="ticket" filter="state=active" container-class="tickets-grid" limit="10" skeleton-count="2" skeleton-all-text="true">

                            <!-- Empty State -->
                            <div slot="empty" class="empty-state">
                                <div class="empty-state__icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M2 9a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3"/>
                                        <path d="M2 9v9a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V9"/>
                                        <path d="M12 13v4"/>
                                        <path d="M10 15h4"/>
                                    </svg>
                                </div>
                                <h3>Keine aktiven Tickets</h3>
                                <p>Du hast derzeit keine Tickets für kommende Spiele.</p>
                                <a href="https://www.hannover96.de/tickets" target="_blank" class="btn btn-primary">
                                    Tickets kaufen
                                </a>
                            </div>

                            <!-- Ticket Card Template -->
                            <template>
                                <div class="ticket-card ticket-card--active">
                                    <div class="ticket-card__badge">Bestätigt</div>
                                    <div class="ticket-card__header">
                                        <h3 class="ticket-card__title">
                                            <ticketable-value name="title"></ticketable-value>
                                        </h3>
                                        <span class="ticket-card__reference">
                                            #<ticketable-value name="reference"></ticketable-value>
                                        </span>
                                    </div>
                                    <div class="ticket-card__details">
                                        <div class="ticket-card__detail">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                <line x1="16" y1="2" x2="16" y2="6"/>
                                                <line x1="8" y1="2" x2="8" y2="6"/>
                                                <line x1="3" y1="10" x2="21" y2="10"/>
                                            </svg>
                                            <ticketable-value name="starts_at" date-format="dd. MMM yyyy, HH:mm"></ticketable-value>
                                        </div>
                                        <div class="ticket-card__detail">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                                <circle cx="12" cy="10" r="3"/>
                                            </svg>
                                            <ticketable-value name="venue"></ticketable-value>
                                        </div>
                                    </div>
                                    <div class="ticket-card__text">
                                        <ticketable-value name="text"></ticketable-value>
                                    </div>
                                    <div class="ticket-card__footer">
                                        <span class="ticket-card__info-banner">
                                            <ticketable-value name="info_banner"></ticketable-value>
                                        </span>
                                        <div class="ticket-card__actions">
                                            <u-ticketable-export format="pdf" custom-class="ticket-export-btn ticket-export-btn--pdf">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                                    <polyline points="14 2 14 8 20 8"/>
                                                    <line x1="12" y1="18" x2="12" y2="12"/>
                                                    <line x1="9" y1="15" x2="15" y2="15"/>
                                                </svg>
                                                PDF
                                            </u-ticketable-export>
                                            <u-ticketable-export format="pkpass" custom-class="ticket-export-btn ticket-export-btn--wallet">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <rect x="2" y="4" width="20" height="16" rx="2"/>
                                                    <path d="M2 10h20"/>
                                                </svg>
                                                Wallet
                                            </u-ticketable-export>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </u-ticketable-list>
                    </section>

                    <!-- Past Matches / Ticket History -->
                    <section class="tickets-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                                Ticket-Verlauf
                            </h2>
                            <div class="section-filter">
                                <select id="state-filter" class="filter-select">
                                    <option value="passive">Abgeschlossen</option>
                                    <option value="inactive">Storniert</option>
                                </select>
                            </div>
                        </div>

                        <u-ticketable-list id="ticket-history" ticketable-type="ticket" filter="state=passive" container-class="tickets-history-grid" limit="20" skeleton-count="3" skeleton-all-text="true">

                            <!-- Empty State -->
                            <div slot="empty" class="empty-state empty-state--compact">
                                <div class="empty-state__icon">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                </div>
                                <h3>Kein Ticket-Verlauf</h3>
                                <p>Du hast noch keine vergangenen Spiele besucht.</p>
                            </div>

                            <!-- History Card Template -->
                            <template>
                                <div class="ticket-history-card">
                                    <div class="ticket-history-card__info">
                                        <h3 class="ticket-history-card__title">
                                            <ticketable-value name="title"></ticketable-value>
                                        </h3>
                                        <div class="ticket-history-card__meta">
                                            <span class="ticket-history-card__date">
                                                <ticketable-value name="starts_at" date-format="dd. MMM yyyy"></ticketable-value>
                                            </span>
                                            <span class="ticket-history-card__divider">&bull;</span>
                                            <span class="ticket-history-card__location">
                                                <ticketable-value name="venue"></ticketable-value>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="ticket-history-card__result">
                                        <ticketable-value name="info_banner"></ticketable-value>
                                    </div>
                                </div>
                            </template>
                        </u-ticketable-list>
                    </section>

                    <!-- CTA Section -->
                    <section class="tickets-cta">
                        <div class="cta-content">
                            <h2>Bereit für das nächste <span class="text-primary">Heimspiel</span>?</h2>
                            <p>Sichere dir jetzt deine Tickets für die HDI-Arena.</p>
                        </div>
                        <a href="https://www.hannover96.de/tickets" target="_blank" class="btn btn-primary btn-lg">
                            Tickets kaufen
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </a>
                    </section>

                </div>

                <script is:inline>
                    document.getElementById('state-filter')?.addEventListener('change', e => {
                        const list = document.getElementById('ticket-history');
                        if (!list) return;

                        if (e.target.value) {
                            list.setAttribute('filter', 'state=' + e.target.value);
                        } else {
                            list.removeAttribute('filter');
                        }
                    });
                </script>
            </u-signed-in>
        </div>
    </main>
</Layout>
