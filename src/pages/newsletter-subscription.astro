---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Newsletter | Hannover 96" activePage="newsletter" pageStyles={['newsletter-subscription']} footerVariant="minimal">
    <!-- Hero Section -->
    <section class="newsletter-hero">
        <div class="container">
            <h1 class="newsletter-hero__title">Hannover 96 Newsletter</h1>
            <p class="newsletter-hero__subtitle">Bleib auf dem Laufenden mit den neuesten News, Spieltag-Infos und exklusiven Angeboten.</p>
        </div>
    </section>

    <!-- Newsletter Root -->
    <u-newsletter-root>
        <u-config
            base-url="https://hannover96.staging.unidy.de"
            api-key="b9671a31543ed2db7679511882ece8fcbd020f8ee996a3274026302a1834c82e"
            locale="de"
        ></u-config>

        <!-- Action Bar -->
        <section class="newsletter-action-bar">
            <div class="container">
                <!-- Not Logged In State -->
                <u-signin-root>
                    <div class="action-bar-card">
                        <div class="action-bar-content">
                            <div class="action-bar-input-group">
                                <div class="action-bar-input-wrapper">
                                    <u-email-field class-name="action-bar-input" name="email" placeholder="Deine E-Mail-Adresse" id="newsletterEmail"></u-email-field>
                                    <u-error-message name="email" class-name="action-bar-error"></u-error-message>
                                </div>
                                <u-submit-button class-name="btn-action-primary">Newsletter abonnieren</u-submit-button>
                            </div>
                        </div>
                        <div class="action-bar-footer">
                            <p class="action-bar-legal">
                                Mit der Anmeldung akzeptierst du unsere <a href="#">Datenschutzerklärung</a>
                            </p>
                            <button type="button" class="action-bar-login-link" onclick="openLoginModal()">Bereits registriert? Hier anmelden</button>
                        </div>
                    </div>
                </u-signin-root>

                <!-- Logged In State -->
                <u-signed-in>
                    <div class="action-bar-card action-bar-card--success">
                        <div class="action-bar-content">
                            <div class="action-bar-user">
                                <div class="action-bar-icon action-bar-icon--success">96</div>
                                <div class="action-bar-user-info">
                                    <span class="action-bar-label">Angemeldet als</span>
                                    <u-field name="email" class-name="action-bar-email" readonly></u-field>
                                </div>
                            </div>
                            <div class="action-bar-actions">
                                <u-newsletter-logout-button class-name="btn-action-secondary">Ausloggen</u-newsletter-logout-button>
                            </div>
                        </div>
                        <p class="action-bar-hint">Wähle unten die Newsletter aus, die du erhalten möchtest</p>
                    </div>
                </u-signed-in>
            </div>
        </section>

        <!-- Newsletter Selection -->
        <main class="newsletter-selection">
            <div class="container">
                <h2 class="section-title">Wähle deine Newsletter</h2>
                <p class="section-subtitle">Entscheide selbst, welche Informationen du erhalten möchtest</p>

                <!-- Featured Newsletter: Hannover 96 Newsletter -->
                <div class="newsletter-featured">
                    <div class="newsletter-card">
                        <div class="newsletter-card__header">
                            <div class="newsletter-card__icon-badge">H96</div>
                            <div class="newsletter-card__info">
                                <h3 class="newsletter-card__title">Hannover 96 Newsletter</h3>
                                <p class="newsletter-card__description">Alle News rund um Hannover 96: Transfers, Interviews, Hintergründe und mehr</p>
                                <span class="newsletter-card__frequency">Wöchentlich</span>
                            </div>
                            <u-newsletter-toggle-subscription-button newsletter-id="h96-main" class-name="toggle-btn toggle-btn--subscribe" subscribed-class-name="toggle-btn--unsubscribe">
                                <span slot="subscribe">Abonnieren</span>
                                <span slot="unsubscribe">Abbestellen</span>
                            </u-newsletter-toggle-subscription-button>
                        </div>
                        <u-error-message name="h96-main" class-name="newsletter-card__error"></u-error-message>

                        <!-- DOI Banner -->
                        <u-conditional-render if="newsletter.h96-main.doiPending">
                            <div class="doi-banner">
                                <span class="doi-banner__text">Bitte bestätige deine E-Mail-Adresse</span>
                                <u-newsletter-resend-doi-button newsletter-id="h96-main" class-name="doi-banner__btn">Erneut senden</u-newsletter-resend-doi-button>
                            </div>
                        </u-conditional-render>

                        <!-- Preferences -->
                        <div class="newsletter-card__preferences">
                            <span class="preferences-label">Themen auswählen:</span>
                            <div class="preferences-list">
                                <label class="preference-chip">
                                    <u-newsletter-preference-checkbox newsletter-id="h96-main" preference-id="news" class-name="preference-input"></u-newsletter-preference-checkbox>
                                    <span class="preference-chip__label">News</span>
                                </label>
                                <label class="preference-chip">
                                    <u-newsletter-preference-checkbox newsletter-id="h96-main" preference-id="transfers" class-name="preference-input"></u-newsletter-preference-checkbox>
                                    <span class="preference-chip__label">Transfers</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other Newsletters Grid -->
                <div class="newsletter-grid">
                    <!-- Spieltag Newsletter -->
                    <div class="newsletter-card newsletter-card--compact">
                        <div class="newsletter-card__header">
                            <div class="newsletter-card__icon-badge">ST</div>
                            <div class="newsletter-card__info">
                                <h3 class="newsletter-card__title">Spieltag</h3>
                                <p class="newsletter-card__description">Aufstellung, Live-Ticker Erinnerung & Ergebnisse</p>
                                <span class="newsletter-card__frequency">Vor jedem Spiel</span>
                            </div>
                            <u-newsletter-toggle-subscription-button newsletter-id="spieltag" class-name="toggle-btn toggle-btn--subscribe" subscribed-class-name="toggle-btn--unsubscribe">
                                <span slot="subscribe">Abonnieren</span>
                                <span slot="unsubscribe">Abbestellen</span>
                            </u-newsletter-toggle-subscription-button>
                        </div>
                        <u-error-message name="spieltag" class-name="newsletter-card__error"></u-error-message>
                    </div>

                    <!-- Shop Newsletter -->
                    <div class="newsletter-card newsletter-card--compact">
                        <div class="newsletter-card__header">
                            <div class="newsletter-card__icon-badge">FS</div>
                            <div class="newsletter-card__info">
                                <h3 class="newsletter-card__title">Fanshop</h3>
                                <p class="newsletter-card__description">Neue Produkte, Angebote und exklusive Rabatte</p>
                                <span class="newsletter-card__frequency">2x monatlich</span>
                            </div>
                            <u-newsletter-toggle-subscription-button newsletter-id="fanshop" class-name="toggle-btn toggle-btn--subscribe" subscribed-class-name="toggle-btn--unsubscribe">
                                <span slot="subscribe">Abonnieren</span>
                                <span slot="unsubscribe">Abbestellen</span>
                            </u-newsletter-toggle-subscription-button>
                        </div>
                        <u-error-message name="fanshop" class-name="newsletter-card__error"></u-error-message>
                    </div>

                    <!-- Membership Newsletter -->
                    <div class="newsletter-card newsletter-card--compact">
                        <div class="newsletter-card__header">
                            <div class="newsletter-card__icon-badge">MG</div>
                            <div class="newsletter-card__info">
                                <h3 class="newsletter-card__title">Mitglieder</h3>
                                <p class="newsletter-card__description">Exklusive Infos und Neuigkeiten für Vereinsmitglieder</p>
                                <span class="newsletter-card__frequency">Monatlich</span>
                            </div>
                            <u-newsletter-toggle-subscription-button newsletter-id="members" class-name="toggle-btn toggle-btn--subscribe" subscribed-class-name="toggle-btn--unsubscribe">
                                <span slot="subscribe">Abonnieren</span>
                                <span slot="unsubscribe">Abbestellen</span>
                            </u-newsletter-toggle-subscription-button>
                        </div>
                        <u-error-message name="members" class-name="newsletter-card__error"></u-error-message>
                    </div>
                </div>
            </div>
        </main>
    </u-newsletter-root>
</Layout>

<script is:inline>
    // Pre-fill email from URL parameter if present
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get('email');
        if (email) {
            const emailField = document.getElementById('newsletterEmail');
            if (emailField) {
                const input = emailField.querySelector('input') || emailField;
                if (input.value !== undefined) {
                    input.value = email;
                }
            }
        }
    });
</script>
