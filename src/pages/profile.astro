---
import Layout from "../layouts/Layout.astro";
---

<Layout
  title="Mein Profil - Hannover 96"
  description="Verwalte deine persönlichen Daten und Einstellungen bei Hannover 96."
  activePage="profile"
  pageStyles={["profile"]}
>
    <main class="profile-main">
        <div class="container">

            <!-- Logged Out State -->
            <u-signed-in not>
                <div class="profile-not-logged-in">
                    <div class="profile-not-logged-in__icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <h1 class="profile-not-logged-in__title">Anmeldung erforderlich</h1>
                    <p class="profile-not-logged-in__text">Bitte melde dich an, um dein Hannover 96 Profil zu verwalten.</p>
                    <button type="button" class="btn btn-primary btn-lg" onclick="openLoginModal()">Jetzt anmelden</button>
                </div>
            </u-signed-in>

            <!-- Logged In State -->
            <u-signed-in>
                <div class="profile-header">
                    <h1 class="profile-header__title">Mein Profil</h1>
                    <p class="profile-header__subtitle">Verwalte deine persönlichen Daten</p>
                </div>

                <div class="profile-content">
                    <u-profile language="de">

                        <!-- Personal Information -->
                        <div class="profile-card">
                            <div class="profile-card__header">
                                <h2 class="profile-card__title">Persönliche Daten</h2>
                            </div>
                            <div class="profile-card__body">
                                <div class="form-grid">
                                    <div class="form-row">
                                        <u-field field="salutation"></u-field>
                                    </div>

                                    <div class="form-row form-row--2col">
                                        <u-field field="first_name"></u-field>
                                        <u-field field="last_name"></u-field>
                                    </div>

                                    <div class="form-row">
                                        <u-field field="date_of_birth"></u-field>
                                    </div>

                                    <div class="form-row form-row--2col">
                                        <u-field field="country_code" country-code-display-option="icon"></u-field>
                                        <u-field field="phone_number"></u-field>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="profile-card">
                            <div class="profile-card__header">
                                <h2 class="profile-card__title">Adresse</h2>
                            </div>
                            <div class="profile-card__body">
                                <div class="form-grid">
                                    <div class="form-row">
                                        <u-field field="address_line_1"></u-field>
                                    </div>

                                    <div class="form-row">
                                        <u-field field="address_line_2"></u-field>
                                    </div>

                                    <div class="form-row form-row--2col">
                                        <u-field field="postal_code"></u-field>
                                        <u-field field="city"></u-field>
                                    </div>

                                    <div class="form-row">
                                        <u-field field="country"></u-field>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="profile-submit">
                            <u-submit-button class-name="profile-submit-btn">
                                Änderungen speichern
                            </u-submit-button>
                        </div>

                        <!-- Update Message -->
                        <div id="profileUpdateMessage" class="profile-update-message"></div>

                    </u-profile>

                    <!-- Logout Section -->
                    <div class="profile-card profile-card--logout">
                        <div class="profile-card__body">
                            <div class="logout-section">
                                <div class="logout-section__info">
                                    <h3 class="logout-section__title">Abmelden</h3>
                                    <p class="logout-section__text">Von deinem Hannover 96 Konto abmelden.</p>
                                </div>
                                <u-logout-button class-name="btn btn-outline logout-btn">Abmelden</u-logout-button>
                            </div>
                        </div>
                    </div>
                </div>
            </u-signed-in>
        </div>
    </main>

    <script is:inline>
        document.addEventListener('DOMContentLoaded', function() {
            // Profile update handlers
            const profileEl = document.querySelector('u-profile');
            const messageEl = document.getElementById('profileUpdateMessage');

            profileEl?.addEventListener('profileUpdated', () => {
                if (messageEl) {
                    messageEl.innerHTML = `
                        <div class="profile-message profile-message--success">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            Profil erfolgreich gespeichert!
                        </div>
                    `;
                    setTimeout(() => { messageEl.innerHTML = ''; }, 3000);
                }
            });

            profileEl?.addEventListener('profileUpdateError', () => {
                if (messageEl) {
                    messageEl.innerHTML = `
                        <div class="profile-message profile-message--error">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                            Fehler beim Speichern. Bitte versuche es erneut.
                        </div>
                    `;
                    setTimeout(() => { messageEl.innerHTML = ''; }, 5000);
                }
            });
        });
    </script>
</Layout>
