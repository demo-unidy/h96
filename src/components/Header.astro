---
interface Props {
    activePage?: 'home' | 'tickets' | 'subscription' | 'newsletter' | 'profile';
}

const { activePage } = Astro.props;

const navItems = [
    { href: '/', label: 'Übersicht', page: 'home' },
    { href: '/tickets', label: 'Tickets', page: 'tickets' },
    { href: '/subscription', label: 'Mitgliedschaft', page: 'subscription' },
    { href: '/newsletter-subscription', label: 'Newsletter', page: 'newsletter' },
    { href: '/profile', label: 'Profil', page: 'profile' },
];
---

<header class="site-header">
    <div class="header-container">
        <a href="/" class="header-logo" aria-label="Hannover 96 Startseite">
            <img src="/assets/images/h96-logo.svg" alt="Hannover 96" height="50">
        </a>

        <nav class="header-nav" aria-label="Hauptnavigation">
            <ul class="nav-list">
                {navItems.map((item) => (
                    <li>
                        <a
                            href={item.href}
                            class:list={[{ 'is-active': activePage === item.page }]}
                        >
                            {item.label}
                        </a>
                    </li>
                ))}
            </ul>
        </nav>

        <div class="header-actions">
            <!-- Login Button (shown when logged out) -->
            <u-signin-root>
                <button type="button" class="header-action-btn" id="headerLoginBtn" aria-label="Anmelden" onclick="openLoginModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </u-signin-root>
            <!-- Auth Icons (shown when logged in) -->
            <u-signed-in>
                <div class="header-auth-icons" id="headerAuthIcons">
                    <a href="/profile" class="header-auth-icon header-auth-icon--profile" title="Mein Profil"></a>
                    <u-logout-button class-name="header-auth-icon header-auth-icon--logout" id="headerLogoutBtn" title="Abmelden"><span></span></u-logout-button>
                </div>
            </u-signed-in>
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Menü öffnen" aria-expanded="false">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>

    <!-- Mobile Navigation Panel -->
    <div class="mobile-nav" id="mobileNav" aria-hidden="true">
        <nav class="mobile-nav__content">
            <ul class="mobile-nav__list">
                {navItems.map((item) => (
                    <li>
                        <a
                            href={item.href}
                            class:list={['mobile-nav__link', { 'is-active': activePage === item.page }]}
                        >
                            {item.label}
                        </a>
                    </li>
                ))}
            </ul>
            <div class="mobile-nav__footer">
                <u-signin-root>
                    <button type="button" class="btn btn-white btn-block" onclick="openLoginModal(); closeMobileMenu();">
                        Anmelden
                    </button>
                </u-signin-root>
                <u-signed-in>
                    <a href="/profile" class="btn btn-white btn-block">Mein Profil</a>
                </u-signed-in>
            </div>
        </nav>
    </div>
</header>

<!-- Mobile Menu Overlay -->
<div class="mobile-nav-overlay" id="mobileNavOverlay"></div>

<script is:inline>
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileNav = document.getElementById('mobileNav');
    const mobileNavOverlay = document.getElementById('mobileNavOverlay');

    function openMobileMenu() {
        mobileMenuBtn.classList.add('is-active');
        mobileMenuBtn.setAttribute('aria-expanded', 'true');
        mobileNav.classList.add('is-open');
        mobileNav.setAttribute('aria-hidden', 'false');
        mobileNavOverlay.classList.add('is-visible');
        document.body.style.overflow = 'hidden';
    }

    function closeMobileMenu() {
        mobileMenuBtn.classList.remove('is-active');
        mobileMenuBtn.setAttribute('aria-expanded', 'false');
        mobileNav.classList.remove('is-open');
        mobileNav.setAttribute('aria-hidden', 'true');
        mobileNavOverlay.classList.remove('is-visible');
        document.body.style.overflow = '';
    }

    function toggleMobileMenu() {
        if (mobileNav.classList.contains('is-open')) {
            closeMobileMenu();
        } else {
            openMobileMenu();
        }
    }

    mobileMenuBtn?.addEventListener('click', toggleMobileMenu);
    mobileNavOverlay?.addEventListener('click', closeMobileMenu);

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && mobileNav?.classList.contains('is-open')) {
            closeMobileMenu();
        }
    });

    // Close menu when clicking a link
    mobileNav?.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', closeMobileMenu);
    });

    // Make closeMobileMenu available globally
    window.closeMobileMenu = closeMobileMenu;
</script>
